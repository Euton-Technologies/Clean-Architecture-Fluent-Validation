# GraphQL Example
This example shows how to use the Clean-Architecture-Fluent-Validation Source Generator to automatically validate persistence layer data annotations without manual duplication for use in a GraphQL project.


## Project Setup

This project was generated by Jason Taylor's [Clean.Architecture.Solution.Template](https://github.com/jasontaylordev/CleanArchitecture) and then modified to be a [HotChocolate](https://chillicream.com/docs/hotchocolate) GraphQL project.

## Usage

```cs
//Application Layer Code
namespace MoviesExample.Application.Genres.Commands.CreateGenre
{
	[ExtendValidation(typeof(Genre))]
    public record CreateGenreCommand : IRequest<CreateGenrePayload>
    {
        public string? Name { get; init; }
    }
    public class CreateGenreCommandValidator : AbstractValidator<CreateGenreCommand>
    {
        public CreateGenreCommandValidator()
        {
            RuleFor(v => v.Name).Name();//The Name method is created automatically by the source generator.
        }
    }
}
//Domain Layer Entities

namespace MoviesExample.Domain.Entities;
{
	public class Genre : BaseAuditableEntity
	{
		[Required]
		[MaxLength(20)]
		public string? Name { get; set; }
	}
}

//Generated code by the source generator
namespace MoviesExample.Application.Genres.Commands.CreateGenre
{
    public static class CreateGenreCommandValidators
    {
        public static IRuleBuilderOptions<CreateGenreCommand, string> Name<CreateGenreCommand>(this IRuleBuilder<CreateGenreCommand, string?> ruleBuilder)
        {
            return ruleBuilder
                .NotEmpty().WithMessage("{0} is required.")
                .MaximumLength(20).WithMessage("{0} must not exceed 20 characters.");
        }
    }
}

```

## Getting Started

Run the GraphQL.sln.  The solution allows you to use either EF Core's In Memory Database or Sql Server depending on the boolean UseInMemoryDatabase.  Once you have the solution running, you'll see HotChocolate's [Banana Cake Pop](https://chillicream.com/docs/bananacakepop/) page.
See Banana Cake Pop Operations for example GraphQL posts.


## GraphQL Query Examples

Get all movies
```query
{
  movies {
     edges{
       node {
         title
         genre {
		   id
           name
         }
       }
     }
  }
}
```

Add a movie.  Note: Titles must be unique so running this query will only work once.  Then you'll have to modify the title
```query
mutation AddMovie {
  addMovie (input: { title: "Super Cool Movie", genreId: "R2VucmUKaTE="}){
    movie {
      id
      title
      genre {
        name
      }
    }
  }
}
```